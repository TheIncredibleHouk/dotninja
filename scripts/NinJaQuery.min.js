function CollectiveFunction(n){function t(){for(var r=[],u=Array.From(arguments),f=this.length,t,i=0;i<f;i++)t=this[i],r.Add(t[n].apply(t,u));return arguments.length==1||n=="Style"?this:r}return t}function From(n){return new QueryClause(n)}function QueryClause(n){if(this.WhereClause=null,n.Type==Type.Array)this.Array=n;else if(n.Type==Type.Dictionary){var t=[];this.Array=t;n.ForEach(function(n){t.Add(n)})}else this.Array=Array.From(n);this.Type=Type.QueryClause}var NinJaQuery={Version:"1.0"},SortOrder;Type.QueryClause=Type.$++;Type.Group=Type.$++;SortOrder={};SortOrder.Ascending=0;SortOrder.Descending=1;Anchor.prototype.Query=Body.prototype.Query=Cell.prototype.Query=Content.prototype.Query=ContentButton.prototype.Query=Div.prototype.Query=Header.prototype.Query=Label.prototype.Query=List.prototype.Query=ListItem.prototype.Query=Row.prototype.Query=Span.prototype.Query=Table.prototype.Query=TableBody.prototype.Query=TableFoot.prototype.Query=TableHead.prototype.Query=TextBox.prototype.Query=function(n){for(var i=Array.From(this.DOM.querySelectorAll(n)),r=i.length,t=0;t<r;t++)i[t]=i[t].$||i[t];return i};Array.prototype.As=function(n){var i=n.prototype;for(var t in i)this[t]=new CollectiveFunction(t);return this};QueryClause.prototype.Where=function(n){return this.WhereClause=n,this};QueryClause.prototype.Select=function(n){return this._Select(n,0)};QueryClause.prototype.SelectFirst=function(n,t){return this._Select(n,t)};QueryClause.prototype._Select=function(n,t){var i=[],f,o,r,e,u;if(this.Array.length==0)return i;for(f=this.Array,o=f.length,u=0;u<o;u++)if((r=f[u],!this.WhereClause||this.WhereClause(r))&&(n?(e=NinJa.EvalBind(n,r),i.push(NullOrUndefined(e)?"":e)):i.push(r),t==1&&i.length>0))return i[0];return i};Array.prototype.Distinct=function(n){var r=[],t,u,i;if(n==undefined)for(u=this.length,t=0;t<u;t++)i=this[t],r.Contains(i)||r.push(i);else for(u=this.length,t=0;t<u;t++)i=NinJa.EvalBind(n,this[t])||"",r.Contains(i)||r.push(i);return r};Array.prototype.Index=function(){for(var i=this.length,t,n=0;n<i;n++)t=this[n],t.$Index=Array.Index(t);return this};Array.Index=function(n){var r,t,i="";for(r in n)if(n.hasOwnProperty(r)&&(t=n[r],!NullOrUndefined(t)))switch(typeof t){case"boolean":case"number":i+=t.toString().toLowerCase();break;case"string":i+=t.toLowerCase();break;case"object":i+=t.hasOwnProperty("getDate")||t.Type==Type.DateTime?t.ToString():Array.Index(t)}return i};Array.prototype.Filter=function(n){if(n=n.toLowerCase().Split(" ",!0),n.length==0)return this;for(var e=this.length,u=[],r,o=n.length,f,t,i=0;i<e;i++){for(t=this[i],f=!0,r=0;r<o;r++)if(t.$Index&&!t.$Index.Contains(n[r])){f=!1;break}f&&!u.Contains(t)&&u.push(t)}return u};Array.prototype.FindNearest=function(n){for(var e=this.length,i=this,t=1,r=i[0],f=Math.abs(n-r),u;t<e;t++)u=Math.abs(n-i[t]),u<f&&(f=u,r=i[t]);return r};Array.prototype.Sort=function(n,t,i){return this.length==0?this:(t=t===undefined?SortOrder.Ascending:t,n!==undefined?this.sort(function(r,u){var f=NinJa.EvalBind(n,r),e=NinJa.EvalBind(n,u);return(f.Type==Type.String&&e.Type==Type.String&&i&&(f=f.toLowerCase(),e=e.toLowerCase()),f===null||f===undefined||e===null||e===undefined)?(f===null||f===undefined)&&e!==null&&e!==undefined?t==SortOrder.Descending?-1:1:(f!==null||f!==undefined)&&!(e===null||e===undefined)?t==SortOrder.Descending?1:-1:0:t==SortOrder.Descending?f.Compare(e)*-1:f.Compare(e)}):this.sort(function(n,r){var u=n,f=r;return(u.Type==Type.String&&f.Type==Type.String&&i&&(u=u.toLowerCase(),f=f.toLowerCase()),u===null||u===undefined||f===null||f===undefined)?(u===null||u===undefined)&&f!==null&&f!==undefined?t==SortOrder.Descending?-1:1:(u!==null||u!==undefined)&&!(f===null||f===undefined)?t==SortOrder.Descending?1:-1:0:t==SortOrder.Descending?u.Compare(f)*-1:u.Compare(f)}),this)};Array.prototype.Flatten=function(){for(var n,r=[],t,u,f=this.length,i=0;i<f;i++)for(t=this[i],u=t.length,n=0;n<u;n++)r.push(t[n]);return r};Array.prototype.Sum=function(){for(var i=0,r=!1,u=this.length,t,n=0;n<u;n++){if(t=this[n],t.Type===Type.String){if(!t.IsFloat()){r=!0;break}t=t.ToFloat()}i+=t}if(r)for(i="",n=0;n<u;n++)i+=this[n];return i};Array.prototype.Intersect=function(n){for(var i=[],r=n.length,t=0;t<r;t++)this.Contains(n[t])&&i.push(n[t]);return i};Array.prototype.Set=function(n,t){for(var f=this.length,i,u,r=0;r<f;r++)i=this[r],u=i[n],u.Type==Type.Function?i[n](t):i[n]=t;return this};Array.prototype.Maximum=function(){return Math.max.apply(this)};Array.prototype.Minimum=function(){return Math.min.apply(this)};Array.prototype.Group=function(n){for(var t=new Dictionary,f=this.length,u,i,r=0;r<f;r++)u=this[r],i=NinJa.EvalBind(n,u),t[i]===undefined&&(t[i]=[]),t[i].Add(u);return t};Array.prototype.Subset=function(n,t){var r=[],u,i;if(n<0)return r;for(t=NullOrUndefined(t)?this.length:t,t>this.length&&(t=this.length),n>t&&(u=t,t=n,n=u),i=n;i<t;i++)r.Add(this[i]);return r};Array.prototype.Take=function(n){return this.Subset(0,n)};